
: FQUIT0
 BEGIN  REFILL
 WHILE
  INTERPRET
 REPEAT ;

: INCLUDE-FILE0 ( i*x fileid -- j*x ) \ 94 FILE
\	." INC"
	>IN  @ >R
	CURSTR @ >R CURSTR 0!
	SOURCE-ID >R  TO SOURCE-ID
\	CR RP@ 6 >> $F AND SPACES ." save=<" SOURCE TYPE ." >"
	SOURCE
	RP@ OVER ALIGNED - RP!
	RP@ SWAP CMOVE
	SOURCE 2>R 
	['] FQUIT0 CATCH	SAVEERR	
\	['] NOOP CATCH	SAVEERR	
	2R> SOURCE!
	RP@ SOURCE CMOVE
\	CR ." IF=<" SOURCE TYPE ." >"
	RP@ SOURCE NIP ALIGNED + RP!
\	CR RP@ 6 >> $F AND SPACES ." rest=<" SOURCE TYPE ." >"
	R> TO SOURCE-ID
	R> CURSTR !
	R> >IN ! THROW  
;

: INCLUDED0  ( c-addr u ---- )
\ Open the file with name c-addr u and interpret all lines contained in it.
\	CR RP@ 6 >> $F AND SPACES ." TO   <" 2DUP TYPE ." >"
	DUP>R 0x20000 ALLOCATE H. H. KEY DROP  RDROP
	2DUP	R/O  OPEN-FILE
 THROW >R
	0x20000 ALLOCATE H. H. KEY DROP
	CFNAME-SET
        VIEW_{
	R@ ['] INCLUDE-FILE0
	CATCH
	}VIEW
\	CR RP@ 8 + 6 >> $F AND SPACES  ." FROM <" CURFILENAME COUNT TYPE ." >"  DUP . 
	DUP  IF CR ." in <" CURFILENAME COUNT TYPE ." >" THEN  CFNAME-FREE
	R> CLOSE-FILE DROP
	THROW
;

S" ALTST.4" INCLUDED0

\ 0x20000 ALLOCATE H. H. KEY DROP

